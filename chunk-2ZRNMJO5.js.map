{
  "version": 3,
  "sources": ["projects/showcase/src/app/demo/examples/cluster-html.component.ts"],
  "sourcesContent": ["import { ChangeDetectionStrategy, Component, computed, input } from '@angular/core';\nimport type {\n  CircleLayerSpecification,\n  SymbolLayerSpecification,\n  ExpressionSpecification,\n  GeoJSONSourceSpecification,\n  MapGeoJSONFeature\n} from 'maplibre-gl';\nimport {\n  MapComponent,\n  LayerComponent,\n  MarkersForClustersComponent,\n  GeoJSONSourceComponent,\n  ClusterPointDirective\n} from '@maplibre/ngx-maplibre-gl';\n\ntype DonuSegmentData = {\n  r: number;\n  r0: number;\n}\n\n@Component({\n  selector: 'showcase-cluster-point',\n  template: `\n    <svg\n      [attr.width]=\"w()\"\n      [attr.height]=\"w()\"\n      [attr.viewbox]=\"viewbox()\"\n      text-anchor=\"middle\"\n      [style.font]=\"font()\"\n    >\n      @for (segment of segments(); track segment) {\n      <path [attr.d]=\"segment.d\" [style.fill]=\"segment.fill\" />\n      }\n      <circle [attr.cx]=\"r()\" [attr.cy]=\"r()\" [attr.r]=\"r0()\" fill=\"white\" />\n      <text dominant-baseline=\"central\" [attr.transform]=\"textTransform()\">\n        {{ totalString() }}\n      </text>\n    </svg>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class ClusterPointComponent {\n  readonly properties = input<MapGeoJSONFeature['properties']>();\n\n  readonly counts = computed(() => {\n    const properties = this.properties();\n    return [\n      properties?.mag1,\n      properties?.mag2,\n      properties?.mag3,\n      properties?.mag4,\n      properties?.mag5,\n    ];\n  });\n\n  readonly data = computed(() => {\n    const counts = this.counts();\n    const offsets: number[] = [];\n    let total = 0;\n    for (let i = 0; i < counts.length; i++) {\n      offsets.push(total);\n      total += counts[i];\n    }\n    return { offsets, total };\n  });\n  readonly total = computed(() => this.data().total);\n  readonly offsets = computed(() => this.data().offsets);\n\n  readonly fontSize = computed(() => {\n    const total = this.total();\n    return total >= 1000 ? 22 : total >= 100 ? 20 : total >= 10 ? 18 : 16;\n  });\n\n  readonly font = computed(() => `${this.fontSize()}px sans-serif`);\n  readonly r = computed(() => {\n    const total = this.total();\n    return total >= 1000 ? 50 : total >= 100 ? 32 : total >= 10 ? 24 : 18;;\n  });\n\n  readonly r0 = computed(() => Math.round(this.r() * 0.6));\n  readonly w = computed(() => this.r() * 2);\n  readonly viewbox = computed(() => `0 0 ${this.w()} ${this.w()}`);\n  readonly textTransform = computed(() => `translate(${this.r()}, ${this.r()})`);\n\n  readonly segments = computed(() => {\n    const counts = this.counts();\n    const offsets = this.offsets();\n    const total = this.total();\n    const r = this.r();\n    const r0 = this.r0();\n    const segments = [];\n    for (let i = 0; i < counts.length; i++) {\n      segments.push(\n        this.donutSegment(\n          { r, r0 },\n          offsets[i] / total,\n          (offsets[i] + counts[i]) / total,\n          COLORS[i]\n        )\n      );\n    }\n    return segments;\n  });\n\n\n  readonly totalString = computed(() => this.total().toLocaleString());\n\n\n  private donutSegment({ r, r0 }: DonuSegmentData, start: number, end: number, color: string) {\n    if (end - start === 1) {\n      end -= 0.00001;\n    }\n    const a0 = 2 * Math.PI * (start - 0.25);\n    const a1 = 2 * Math.PI * (end - 0.25);\n    const x0 = Math.cos(a0),\n      y0 = Math.sin(a0);\n    const x1 = Math.cos(a1),\n      y1 = Math.sin(a1);\n    const largeArc = end - start > 0.5 ? 1 : 0;\n    return {\n      d: `M ${r + r0 * x0} ${r + r0 * y0} L ${r + r * x0\n        } ${r + r * y0} A ${r} ${r} 0 ${largeArc} 1 ${r + r * x1\n        } ${r + r * y1} L ${r + r0 * x1} ${r + r0 * y1\n        } A ${r0} ${r0} 0 ${largeArc} 0 ${r + r0 * x0} ${r + r0 * y0\n        }`,\n      fill: color,\n    };\n  }\n}\n\n/**\n * Remember: mgl-layer are way faster than html markers\n * Html markers are fine if you don't have lots of points\n * Try to draw your point with a mgl-layer before using html markers\n * This example only use html markers for cluster points\n * Look at ngx-cluster-html example if you need markers for all points\n */\n\n// colors to use for the categories\nconst COLORS = ['#fed976', '#feb24c', '#fd8d3c', '#fc4e2a', '#e31a1c'];\n\n// filters for classifying earthquakes into five categories based on magnitude\nconst MAG1 = ['<', ['get', 'mag'], 2] as ExpressionSpecification;\n\nconst MAG2 = [\n  'all',\n  ['>=', ['get', 'mag'], 2],\n  ['<', ['get', 'mag'], 3],\n] as ExpressionSpecification;\n\nconst MAG3 = [\n  'all',\n  ['>=', ['get', 'mag'], 3],\n  ['<', ['get', 'mag'], 4],\n] as ExpressionSpecification;\n\nconst MAG4 = [\n  'all',\n  ['>=', ['get', 'mag'], 4],\n  ['<', ['get', 'mag'], 5],\n] as ExpressionSpecification;\n\nconst MAG5 = ['>=', ['get', 'mag'], 5];\n\n\n@Component({\n  selector: 'showcase-demo',\n  template: `\n    <mgl-map\n      [mapStyle]=\"\n        'https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL'\n      \"\n      [zoom]=\"[0.3]\"\n      [center]=\"[0, 20]\"\n      [canvasContextAttributes]=\"{preserveDrawingBuffer: true}\"\n    >\n      <mgl-geojson-source\n        id=\"earthquakes\"\n        data=\"https://maplibre.org/maplibre-gl-js/docs/assets/earthquakes.geojson\"\n        [cluster]=\"true\"\n        [clusterRadius]=\"80\"\n        [clusterProperties]=\"clusterProperties\"\n      />\n      <mgl-markers-for-clusters source=\"earthquakes\">\n        <ng-template mglClusterPoint let-feature>\n          <showcase-cluster-point\n            [properties]=\"feature.properties\"\n          />\n        </ng-template>\n      </mgl-markers-for-clusters>\n      <mgl-layer\n        id=\"earthquake_circle\"\n        type=\"circle\"\n        source=\"earthquakes\"\n        [filter]=\"['!=', 'cluster', true]\"\n        [paint]=\"circlePaint\"\n      />\n      <mgl-layer\n        id=\"earthquake_label\"\n        type=\"symbol\"\n        source=\"earthquakes\"\n        [filter]=\"['!=', 'cluster', true]\"\n        [layout]=\"labelLayout\"\n        [paint]=\"labelPaint\"\n      />\n    </mgl-map>\n  `,\n  styleUrls: ['./examples.css'],\n  imports: [\n    MapComponent,\n    GeoJSONSourceComponent,\n    MarkersForClustersComponent,\n    ClusterPointDirective,\n    ClusterPointComponent,\n    LayerComponent,\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class ClusterHtmlComponent {\n  readonly clusterProperties: GeoJSONSourceSpecification['clusterProperties'] = {\n    // keep separate counts for each magnitude category in a cluster\n    mag1: ['+', ['case', MAG1, 1, 0]],\n    mag2: ['+', ['case', MAG2, 1, 0]],\n    mag3: ['+', ['case', MAG3, 1, 0]],\n    mag4: ['+', ['case', MAG4, 1, 0]],\n    mag5: ['+', ['case', MAG5, 1, 0]],\n  };\n\n  readonly circlePaint: CircleLayerSpecification['paint'] = {\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    'circle-color': [\n      'case',\n      MAG1,\n      COLORS[0],\n      MAG2,\n      COLORS[1],\n      MAG3,\n      COLORS[2],\n      MAG4,\n      COLORS[3],\n      COLORS[4],\n    ],\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    'circle-opacity': 0.6,\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    'circle-radius': 12,\n  };\n  readonly labelLayout: SymbolLayerSpecification['layout'] = {\n    // typings issue\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    'text-field': [\n      'number-format',\n      ['get', 'mag'],\n      // eslint-disable-next-line @typescript-eslint/naming-convention\n      { 'min-fraction-digits': 1, 'max-fraction-digits': 1 },\n    ],\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    'text-font': ['Open Sans Semibold', 'Arial Unicode MS Bold'],\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    'text-size': 10,\n  };\n  readonly labelPaint: SymbolLayerSpecification['paint'] = {\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    'text-color': ['case', ['<', ['get', 'mag'], 3], 'black', 'white'],\n  };\n}\n"],
  "mappings": "0SAgCMA,EAAA,EAAA,MAAA,0BAA2BC,EAAA,OAAAC,EAAAC,IAAA,+HA0JvBC,EAAA,EAAA,yBAAA,CAAA,yBACEC,EAAA,aAAAC,EAAAC,UAAA,GAjJZ,IAAaC,GAAqB,IAAA,CAA5B,MAAOA,CAAqB,CArBlCC,aAAA,CAsBW,KAAAF,WAAaG,EAAK,EAElB,KAAAC,OAASC,EAAS,IAAK,CAC9B,IAAML,EAAa,KAAKA,WAAU,EAClC,MAAO,CACLA,GAAYM,KACZN,GAAYO,KACZP,GAAYQ,KACZR,GAAYS,KACZT,GAAYU,IAAI,CAEpB,CAAC,EAEQ,KAAAC,KAAON,EAAS,IAAK,CAC5B,IAAMD,EAAS,KAAKA,OAAM,EACpBQ,EAAoB,CAAA,EACtBC,EAAQ,EACZ,QAASC,EAAI,EAAGA,EAAIV,EAAOW,OAAQD,IACjCF,EAAQI,KAAKH,CAAK,EAClBA,GAAST,EAAOU,CAAC,EAEnB,MAAO,CAAEF,QAAAA,EAASC,MAAAA,CAAK,CACzB,CAAC,EACQ,KAAAA,MAAQR,EAAS,IAAM,KAAKM,KAAI,EAAGE,KAAK,EACxC,KAAAD,QAAUP,EAAS,IAAM,KAAKM,KAAI,EAAGC,OAAO,EAE5C,KAAAK,SAAWZ,EAAS,IAAK,CAChC,IAAMQ,EAAQ,KAAKA,MAAK,EACxB,OAAOA,GAAS,IAAO,GAAKA,GAAS,IAAM,GAAKA,GAAS,GAAK,GAAK,EACrE,CAAC,EAEQ,KAAAK,KAAOb,EAAS,IAAM,GAAG,KAAKY,SAAQ,CAAE,eAAe,EACvD,KAAAE,EAAId,EAAS,IAAK,CACzB,IAAMQ,EAAQ,KAAKA,MAAK,EACxB,OAAOA,GAAS,IAAO,GAAKA,GAAS,IAAM,GAAKA,GAAS,GAAK,GAAK,EACrE,CAAC,EAEQ,KAAAO,GAAKf,EAAS,IAAMgB,KAAKC,MAAM,KAAKH,EAAC,EAAK,EAAG,CAAC,EAC9C,KAAAI,EAAIlB,EAAS,IAAM,KAAKc,EAAC,EAAK,CAAC,EAC/B,KAAAK,QAAUnB,EAAS,IAAM,OAAO,KAAKkB,EAAC,CAAE,IAAI,KAAKA,EAAC,CAAE,EAAE,EACtD,KAAAE,cAAgBpB,EAAS,IAAM,aAAa,KAAKc,EAAC,CAAE,KAAK,KAAKA,EAAC,CAAE,GAAG,EAEpE,KAAAO,SAAWrB,EAAS,IAAK,CAChC,IAAMD,EAAS,KAAKA,OAAM,EACpBQ,EAAU,KAAKA,QAAO,EACtBC,EAAQ,KAAKA,MAAK,EAClBM,EAAI,KAAKA,EAAC,EACVC,EAAK,KAAKA,GAAE,EACZM,EAAW,CAAA,EACjB,QAASZ,EAAI,EAAGA,EAAIV,EAAOW,OAAQD,IACjCY,EAASV,KACP,KAAKW,aACH,CAAER,EAAAA,EAAGC,GAAAA,CAAE,EACPR,EAAQE,CAAC,EAAID,GACZD,EAAQE,CAAC,EAAIV,EAAOU,CAAC,GAAKD,EAC3Be,EAAOd,CAAC,CAAC,CACV,EAGL,OAAOY,CACT,CAAC,EAGQ,KAAAG,YAAcxB,EAAS,IAAM,KAAKQ,MAAK,EAAGiB,eAAc,CAAE,EAG3DH,aAAa,CAAER,EAAAA,EAAGC,GAAAA,CAAE,EAAqBW,EAAeC,EAAaC,EAAa,CACpFD,EAAMD,IAAU,IAClBC,GAAO,MAET,IAAME,EAAK,EAAIb,KAAKc,IAAMJ,EAAQ,KAC5BK,EAAK,EAAIf,KAAKc,IAAMH,EAAM,KAC1BK,EAAKhB,KAAKiB,IAAIJ,CAAE,EACpBK,EAAKlB,KAAKmB,IAAIN,CAAE,EACZO,EAAKpB,KAAKiB,IAAIF,CAAE,EACpBM,EAAKrB,KAAKmB,IAAIJ,CAAE,EACZO,EAAWX,EAAMD,EAAQ,GAAM,EAAI,EACzC,MAAO,CACLa,EAAG,KAAKzB,EAAIC,EAAKiB,CAAE,IAAIlB,EAAIC,EAAKmB,CAAE,MAAMpB,EAAIA,EAAIkB,CAC9C,IAAIlB,EAAIA,EAAIoB,CAAE,MAAMpB,CAAC,IAAIA,CAAC,MAAMwB,CAAQ,MAAMxB,EAAIA,EAAIsB,CACtD,IAAItB,EAAIA,EAAIuB,CAAE,MAAMvB,EAAIC,EAAKqB,CAAE,IAAItB,EAAIC,EAAKsB,CAC5C,MAAMtB,CAAE,IAAIA,CAAE,MAAMuB,CAAQ,MAAMxB,EAAIC,EAAKiB,CAAE,IAAIlB,EAAIC,EAAKmB,CAC1D,GACF3C,KAAMqC,EAEV,iDAtFWhC,EAAqB,CAAA,+BAArBA,EAAqB4C,UAAA,CAAA,CAAA,wBAAA,CAAA,EAAAC,OAAA,CAAA9C,WAAA,CAAA,EAAA,YAAA,CAAA,EAAA+C,MAAA,EAAAC,KAAA,GAAAC,OAAA,CAAA,CAAA,cAAA,QAAA,EAAA,CAAA,EAAA,MAAA,EAAA,CAAA,OAAA,OAAA,EAAA,CAAA,oBAAA,SAAA,CAAA,EAAAC,SAAA,SAAAC,EAAAC,EAAA,CAAAD,EAAA,QAlB9BE,EAAA,EAAA,MAAA,CAAA,EAOEC,EAAA,EAAAC,EAAA,EAAA,EAAA,YAAA,EAAAC,CAAA,EAGA/D,EAAA,EAAA,SAAA,CAAA,EACA4D,EAAA,EAAA,OAAA,CAAA,EACEI,EAAA,CAAA,EACFC,EAAA,EAAO,SARPhE,EAAA,OAAA0D,EAAAlC,KAAA,CAAA,0DAEAyC,EAAA,EAAAC,EAAAR,EAAA1B,SAAA,CAAU,EAGFiC,EAAA,CAAA,wCAC0BA,EAAA,mCAChCA,EAAA,EAAAE,EAAA,IAAAT,EAAAvB,YAAA,EAAA,GAAA,gDAMK5B,CAAqB,GAAA,EAkG5B2B,EAAS,CAAC,UAAW,UAAW,UAAW,UAAW,SAAS,EAG/DkC,EAAO,CAAC,IAAK,CAAC,MAAO,KAAK,EAAG,CAAC,EAE9BC,EAAO,CACX,MACA,CAAC,KAAM,CAAC,MAAO,KAAK,EAAG,CAAC,EACxB,CAAC,IAAK,CAAC,MAAO,KAAK,EAAG,CAAC,CAAC,EAGpBC,EAAO,CACX,MACA,CAAC,KAAM,CAAC,MAAO,KAAK,EAAG,CAAC,EACxB,CAAC,IAAK,CAAC,MAAO,KAAK,EAAG,CAAC,CAAC,EAGpBC,EAAO,CACX,MACA,CAAC,KAAM,CAAC,MAAO,KAAK,EAAG,CAAC,EACxB,CAAC,IAAK,CAAC,MAAO,KAAK,EAAG,CAAC,CAAC,EAGpBC,EAAO,CAAC,KAAM,CAAC,MAAO,KAAK,EAAG,CAAC,EAwDxBC,IAAoB,IAAA,CAA3B,MAAOA,CAAoB,CArDjCjE,aAAA,CAsDW,KAAAkE,kBAAqE,CAE5E9D,KAAM,CAAC,IAAK,CAAC,OAAQwD,EAAM,EAAG,CAAC,CAAC,EAChCvD,KAAM,CAAC,IAAK,CAAC,OAAQwD,EAAM,EAAG,CAAC,CAAC,EAChCvD,KAAM,CAAC,IAAK,CAAC,OAAQwD,EAAM,EAAG,CAAC,CAAC,EAChCvD,KAAM,CAAC,IAAK,CAAC,OAAQwD,EAAM,EAAG,CAAC,CAAC,EAChCvD,KAAM,CAAC,IAAK,CAAC,OAAQwD,EAAM,EAAG,CAAC,CAAC,GAGzB,KAAAG,YAAiD,CAExD,eAAgB,CACd,OACAP,EACAlC,EAAO,CAAC,EACRmC,EACAnC,EAAO,CAAC,EACRoC,EACApC,EAAO,CAAC,EACRqC,EACArC,EAAO,CAAC,EACRA,EAAO,CAAC,CAAC,EAGX,iBAAkB,GAElB,gBAAiB,IAEV,KAAA0C,YAAkD,CAGzD,aAAc,CACZ,gBACA,CAAC,MAAO,KAAK,EAEb,CAAE,sBAAuB,EAAG,sBAAuB,CAAC,CAAE,EAGxD,YAAa,CAAC,qBAAsB,uBAAuB,EAE3D,YAAa,IAEN,KAAAC,WAAgD,CAEvD,aAAc,CAAC,OAAQ,CAAC,IAAK,CAAC,MAAO,KAAK,EAAG,CAAC,EAAG,QAAS,OAAO,mDA7CxDJ,EAAoB,CAAA,+BAApBA,EAAoBtB,UAAA,CAAA,CAAA,eAAA,CAAA,EAAAE,MAAA,EAAAC,KAAA,GAAAC,OAAA,CAAA,CAAA,EAAA,WAAA,OAAA,SAAA,yBAAA,EAAA,CAAA,KAAA,cAAA,OAAA,sEAAA,EAAA,UAAA,gBAAA,mBAAA,EAAA,CAAA,SAAA,aAAA,EAAA,CAAA,kBAAA,EAAA,EAAA,CAAA,KAAA,oBAAA,OAAA,SAAA,SAAA,cAAA,EAAA,SAAA,OAAA,EAAA,CAAA,KAAA,mBAAA,OAAA,SAAA,SAAA,cAAA,EAAA,SAAA,SAAA,OAAA,EAAA,CAAA,EAAA,YAAA,CAAA,EAAAC,SAAA,SAAAC,EAAAC,EAAA,CAAAD,EAAA,IAlD7BqB,EAAA,EAAA,UAAA,CAAA,EAQE3E,EAAA,EAAA,qBAAA,CAAA,EAOA2E,EAAA,EAAA,2BAAA,CAAA,EACEC,EAAA,EAAAC,EAAA,EAAA,EAAA,cAAA,CAAA,EAKFC,EAAA,EACA9E,EAAA,EAAA,YAAA,CAAA,EAME,EAAA,YAAA,CAAA,EASJ8E,EAAA,SApCE7E,EAAA,WAAA,wFAAA,EAEC,OAAA8E,EAAA,GAAAC,CAAA,CAAA,EACa,SAAAD,EAAA,GAAAE,CAAA,CAAA,EACI,0BAAAF,EAAA,GAAAG,CAAA,CAAA,EAMhBpB,EAAA,EAAA7D,EAAA,UAAA,EAAA,EAAgB,gBAAA,EAAA,EACI,oBAAAsD,EAAAgB,iBAAA,EAcpBT,EAAA,CAAA,EAAA7D,EAAA,SAAA8E,EAAA,GAAAI,CAAA,CAAA,EAAkC,QAAA5B,EAAAiB,WAAA,EAOlCV,EAAA,EAAA7D,EAAA,SAAA8E,EAAA,GAAAI,CAAA,CAAA,EAAkC,SAAA5B,EAAAkB,WAAA,EACZ,QAAAlB,EAAAmB,UAAA,kBAO1BU,EACAC,EACAC,EACAC,EA3KSnF,EA6KToF,CAAc,EAAAC,OAAA,CAAA;kDAAA,EAAAC,gBAAA,CAAA,CAAA,CAAA,SAILpB,CAAoB,GAAA",
  "names": ["\u0275\u0275domElement", "\u0275\u0275styleProp", "segment_r1", "fill", "\u0275\u0275element", "\u0275\u0275property", "feature_r1", "properties", "ClusterPointComponent", "constructor", "input", "counts", "computed", "mag1", "mag2", "mag3", "mag4", "mag5", "data", "offsets", "total", "i", "length", "push", "fontSize", "font", "r", "r0", "Math", "round", "w", "viewbox", "textTransform", "segments", "donutSegment", "COLORS", "totalString", "toLocaleString", "start", "end", "color", "a0", "PI", "a1", "x0", "cos", "y0", "sin", "x1", "y1", "largeArc", "d", "selectors", "inputs", "decls", "vars", "consts", "template", "rf", "ctx", "\u0275\u0275domElementStart", "\u0275\u0275repeaterCreate", "ClusterPointComponent_For_2_Template", "\u0275\u0275repeaterTrackByIdentity", "\u0275\u0275text", "\u0275\u0275domElementEnd", "\u0275\u0275advance", "\u0275\u0275repeater", "\u0275\u0275textInterpolate1", "MAG1", "MAG2", "MAG3", "MAG4", "MAG5", "ClusterHtmlComponent", "clusterProperties", "circlePaint", "labelLayout", "labelPaint", "\u0275\u0275elementStart", "\u0275\u0275template", "ClusterHtmlComponent_ng_template_3_Template", "\u0275\u0275elementEnd", "\u0275\u0275pureFunction0", "_c0", "_c1", "_c2", "_c3", "MapComponent", "GeoJSONSourceComponent", "MarkersForClustersComponent", "ClusterPointDirective", "LayerComponent", "styles", "changeDetection"]
}
